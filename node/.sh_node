#!/bin/bash

PATH="$HOME/.npm-global/bin:$PATH"
PATH="./node_modules/.bin:$PATH"
export PATH

if [ -x "$(command -v fnm)" ]; then
    eval "$(fnm env --use-on-cd)"
    source <(npm completion)
fi

autoload -U add-zsh-hook
add-zsh-hook -Uz chpwd set_node_version

set_node_version() {
    if [ -f "serverless.yml" ]; then
        # get node version from serverless.yml
        version=$(yq .provider.runtime serverless.yml)
        # bash substitute (remove) "nodejs" from value. fnm use the output
        fnm use "${version#"nodejs"}"
    fi
}
